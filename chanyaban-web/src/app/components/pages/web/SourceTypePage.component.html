<menu-top [isAddSearch]="false" [selectedDate]="selectedDate" [keepDate]="data.keepDate" [searchKeywordAll]="[]" (changeSelectdate)="changeSelectdate($event)"></menu-top>
<ng-container *ngIf="(!sourceType || notFind && notFind.length > 0) && isInitial; else elseNotFind">
    <div class="wrapper-not-find">
        <ng-container *ngIf="!sourceType; else elseIsNewsAgency">
            <div class="not-find">
                <span>ไม่พบช่องทางการสื่อสาร</span>
                {{sourceTypeName}}
            </div>
        </ng-container>
        <ng-template #elseIsNewsAgency>
            <div class="label-source-type">ช่องทางการสื่อสาร: {{sourceTypeName}}</div> <br>
            <div class="not-find">
                <span> ไม่พบข้อมูล</span>
                <ng-container *ngFor="let item of notFind; let index = index">
                    {{index > 0 ? ', '+item.name : item.name}}
                </ng-container>
            </div>
            <div class="wrapper-link" *ngIf="searchKeywordAll && searchKeywordAll.length > 0">
                <span>ข้อมูลที่พบ </span>
                <ng-container *ngFor="let item of searchKeywordAll; let index = index">
                    {{index > 0 ? ', '+item.name : item.name}}
                </ng-container>
                <span class="link" (click)="clickSearchAll(searchKeywordAll.length-1)">
                    กดเพื่อดูข้อมูลเหล่านี้
                </span>
            </div>
        </ng-template>
    </div>
</ng-container>
<ng-template #elseNotFind>
    <div id="pathNewsAgencyTop" class="wrapper-path-keyword-top" [ngStyle]="{'display': searchKeywordAll && searchKeywordAll.length > 0 ? flex : none}">
        <div class="wrapper-path-keyword">
            <span class="wrapper-path" *ngIf="sourceType">
                /
                <span class="link" (click)="clickToSourceType()">
                    <img *ngIf="sourceType.icon" class="icon" src="{{sourceType.icon}}" alt=""> {{sourceType.name}}
                </span>
                <svg (click)="newTabNewsAgency(sourceType.name)" class="icon-new-tab new-tab" height="512pt" viewBox="0 0 512 512.00578"
                    width="512pt" xmlns="http://www.w3.org/2000/svg">
                    <path d="m507.523438 148.890625-138.667969-144c-4.523438-4.691406-11.457031-6.164063-17.492188-3.734375-6.058593 2.453125-10.027343 8.320312-10.027343 14.847656v69.335938h-5.332032c-114.6875 0-208 93.3125-208 208v32c0 7.421875 5.226563 13.609375 12.457032 15.296875 1.175781.296875 2.347656.425781 3.519531.425781 6.039062 0 11.820312-3.542969 14.613281-9.109375 29.996094-60.011719 90.304688-97.28125 157.398438-97.28125h25.34375v69.332031c0 6.53125 3.96875 12.398438 10.027343 14.828125 5.996094 2.453125 12.96875.960938 17.492188-3.734375l138.667969-144c5.972656-6.207031 5.972656-15.976562 0-22.207031zm0 0"
                    />
                    <path d="m448.003906 512.003906h-384c-35.285156 0-63.99999975-28.710937-63.99999975-64v-298.664062c0-35.285156 28.71484375-64 63.99999975-64h64c11.796875 0 21.332032 9.535156 21.332032 21.332031s-9.535157 21.332031-21.332032 21.332031h-64c-11.777344 0-21.335937 9.558594-21.335937 21.335938v298.664062c0 11.777344 9.558593 21.335938 21.335937 21.335938h384c11.773438 0 21.332032-9.558594 21.332032-21.335938v-170.664062c0-11.796875 9.535156-21.335938 21.332031-21.335938 11.800781 0 21.335937 9.539063 21.335937 21.335938v170.664062c0 35.289063-28.714844 64-64 64zm0 0"
                    />
                </svg>
            </span> 
            <ng-container *ngFor="let keyEntity of searchKeywordAll; let i = index">
                <span class="wrapper-path">
                    /
                    <span class="link" (click)="clickSearchAll(i)">
                        <img *ngIf="keyEntity.image" class="icon" src="{{keyEntity.image}}" alt=""> {{keyEntity.isTag ? "#
                        " : ""}}{{keyEntity.name}}
                    </span>
                    <svg (click)="newTab(keyEntity.image ? ':'+keyEntity.name : keyEntity.name)" class="icon-new-tab new-tab" height="512pt"
                        viewBox="0 0 512 512.00578" width="512pt" xmlns="http://www.w3.org/2000/svg">
                        <path d="m507.523438 148.890625-138.667969-144c-4.523438-4.691406-11.457031-6.164063-17.492188-3.734375-6.058593 2.453125-10.027343 8.320312-10.027343 14.847656v69.335938h-5.332032c-114.6875 0-208 93.3125-208 208v32c0 7.421875 5.226563 13.609375 12.457032 15.296875 1.175781.296875 2.347656.425781 3.519531.425781 6.039062 0 11.820312-3.542969 14.613281-9.109375 29.996094-60.011719 90.304688-97.28125 157.398438-97.28125h25.34375v69.332031c0 6.53125 3.96875 12.398438 10.027343 14.828125 5.996094 2.453125 12.96875.960938 17.492188-3.734375l138.667969-144c5.972656-6.207031 5.972656-15.976562 0-22.207031zm0 0"
                        />
                        <path d="m448.003906 512.003906h-384c-35.285156 0-63.99999975-28.710937-63.99999975-64v-298.664062c0-35.285156 28.71484375-64 63.99999975-64h64c11.796875 0 21.332032 9.535156 21.332032 21.332031s-9.535157 21.332031-21.332032 21.332031h-64c-11.777344 0-21.335937 9.558594-21.335937 21.335938v298.664062c0 11.777344 9.558593 21.335938 21.335937 21.335938h384c11.773438 0 21.332032-9.558594 21.332032-21.335938v-170.664062c0-11.796875 9.535156-21.335938 21.332031-21.335938 11.800781 0 21.335937 9.539063 21.335937 21.335938v170.664062c0 35.289063-28.714844 64-64 64zm0 0"
                        />
                    </svg>
                </span>
            </ng-container>
        </div>
    </div>
    <div class="card-main-source-type">
        <div class="wrapper-main">
            <div class="wrapper-left">
                <div class="wrapper-overview">
                    <div class="wrapper-group-keyword" *ngIf="listEntityKeyword && listEntityKeyword.length > 0">
                        <div class="label-group-keyword">
                            คีย์เวิร์ดที่นำมารวม:
                        </div>
                        <div class="list-group-keyword">
                            <ng-container *ngFor="let entityKeyword of listEntityKeyword; let ekIndex=index">
                                <ng-container *ngFor="let keyword of entityKeyword; let kIndex=index">
                                    <div class="group-keyword" [class.active]="keyword.isActive" (click)="clickSelectEntityKeyword(ekIndex, kIndex)">
                                        {{keyword.name}}
                                    </div>
                                </ng-container>
                            </ng-container>
                        </div>
                    </div>
                    <ng-container *ngIf="searchKeywordAll && searchKeywordAll.length > 0; else elseIsSearchKeywordAll">
                        <div class="wrapper-search-all">
                            /
                            <span class="wrapper-path">
                                <span class="link" (click)="clickToSourceType()">
                                    <img *ngIf="sourceType.icon" class="icon" src="{{sourceType.icon}}" alt="">
                                    <span>
                                        {{sourceType.name}}
                                    </span>
                                </span>
                                <svg (click)="newTabNewsAgency(sourceType.name)" class="icon-new-tab new-tab" height="512pt" viewBox="0 0 512 512.00578"
                                    width="512pt" xmlns="http://www.w3.org/2000/svg">
                                    <path d="m507.523438 148.890625-138.667969-144c-4.523438-4.691406-11.457031-6.164063-17.492188-3.734375-6.058593 2.453125-10.027343 8.320312-10.027343 14.847656v69.335938h-5.332032c-114.6875 0-208 93.3125-208 208v32c0 7.421875 5.226563 13.609375 12.457032 15.296875 1.175781.296875 2.347656.425781 3.519531.425781 6.039062 0 11.820312-3.542969 14.613281-9.109375 29.996094-60.011719 90.304688-97.28125 157.398438-97.28125h25.34375v69.332031c0 6.53125 3.96875 12.398438 10.027343 14.828125 5.996094 2.453125 12.96875.960938 17.492188-3.734375l138.667969-144c5.972656-6.207031 5.972656-15.976562 0-22.207031zm0 0"
                                    />
                                    <path d="m448.003906 512.003906h-384c-35.285156 0-63.99999975-28.710937-63.99999975-64v-298.664062c0-35.285156 28.71484375-64 63.99999975-64h64c11.796875 0 21.332032 9.535156 21.332032 21.332031s-9.535157 21.332031-21.332032 21.332031h-64c-11.777344 0-21.335937 9.558594-21.335937 21.335938v298.664062c0 11.777344 9.558593 21.335938 21.335937 21.335938h384c11.773438 0 21.332032-9.558594 21.332032-21.335938v-170.664062c0-11.796875 9.535156-21.335938 21.332031-21.335938 11.800781 0 21.335937 9.539063 21.335937 21.335938v170.664062c0 35.289063-28.714844 64-64 64zm0 0"
                                    />
                                </svg>
                            </span>
                            {{searchKeywordAll.length === 0 ? "/" : ""}}
                            <ng-container *ngFor="let keyEntity of searchKeywordAll; let i = index">
                                <ng-container *ngIf="searchKeywordAll.length - 1 !== i">
                                    /
                                    <span class="wrapper-path">
                                        <span class="link" (click)="clickSearchAll(i)">
                                            <img *ngIf="keyEntity.image" class="icon" src="{{keyEntity.image}}" alt="">
                                            <span>
                                                {{keyEntity.isTag ? "# " : ""}}{{keyEntity.name}}
                                            </span>
                                        </span>
                                        <svg (click)="newTab(keyEntity.image ? ':'+keyEntity.name : keyEntity.name)" class="icon-new-tab new-tab" height="512pt"
                                            viewBox="0 0 512 512.00578" width="512pt" xmlns="http://www.w3.org/2000/svg">
                                            <path d="m507.523438 148.890625-138.667969-144c-4.523438-4.691406-11.457031-6.164063-17.492188-3.734375-6.058593 2.453125-10.027343 8.320312-10.027343 14.847656v69.335938h-5.332032c-114.6875 0-208 93.3125-208 208v32c0 7.421875 5.226563 13.609375 12.457032 15.296875 1.175781.296875 2.347656.425781 3.519531.425781 6.039062 0 11.820312-3.542969 14.613281-9.109375 29.996094-60.011719 90.304688-97.28125 157.398438-97.28125h25.34375v69.332031c0 6.53125 3.96875 12.398438 10.027343 14.828125 5.996094 2.453125 12.96875.960938 17.492188-3.734375l138.667969-144c5.972656-6.207031 5.972656-15.976562 0-22.207031zm0 0"
                                            />
                                            <path d="m448.003906 512.003906h-384c-35.285156 0-63.99999975-28.710937-63.99999975-64v-298.664062c0-35.285156 28.71484375-64 63.99999975-64h64c11.796875 0 21.332032 9.535156 21.332032 21.332031s-9.535157 21.332031-21.332032 21.332031h-64c-11.777344 0-21.335937 9.558594-21.335937 21.335938v298.664062c0 11.777344 9.558593 21.335938 21.335937 21.335938h384c11.773438 0 21.332032-9.558594 21.332032-21.335938v-170.664062c0-11.796875 9.535156-21.335938 21.332031-21.335938 11.800781 0 21.335937 9.539063 21.335937 21.335938v170.664062c0 35.289063-28.714844 64-64 64zm0 0"
                                            />
                                        </svg>
                                    </span>
                                </ng-container>
                            </ng-container>
                            {{searchKeywordAll.length > 1 ? "/" : ""}}
                        </div>
                        <div class="wrapper-keyword">
                            <span (click)="loadDataPage()">
                                <ng-container *ngIf="searchKeywordAll[searchKeywordAll.length - 1].personaType; else elseIsEntity">
                                    <img class="icon-entity-type" src="{{searchKeywordAll[searchKeywordAll.length - 1].image}}" alt="">                                    {{searchKeywordAll[searchKeywordAll.length
                                    - 1].name}}
                                </ng-container>
                                <ng-template #elseIsEntity>
                                    {{searchKeywordAll[searchKeywordAll.length - 1].isTag ? "# " : ""}}{{ searchKeywordAll[searchKeywordAll.length - 1].name}}
                                </ng-template>
                            </span>
                            <svg (click)="newTab(searchKeywordAll[searchKeywordAll.length - 1].image ? ':'+searchKeywordAll[searchKeywordAll.length - 1].name : searchKeywordAll[searchKeywordAll.length - 1].name)"
                                class="icon-new-tab new-tab" height="512pt" viewBox="0 0 512 512.00578" width="512pt" xmlns="http://www.w3.org/2000/svg">
                                <path d="m507.523438 148.890625-138.667969-144c-4.523438-4.691406-11.457031-6.164063-17.492188-3.734375-6.058593 2.453125-10.027343 8.320312-10.027343 14.847656v69.335938h-5.332032c-114.6875 0-208 93.3125-208 208v32c0 7.421875 5.226563 13.609375 12.457032 15.296875 1.175781.296875 2.347656.425781 3.519531.425781 6.039062 0 11.820312-3.542969 14.613281-9.109375 29.996094-60.011719 90.304688-97.28125 157.398438-97.28125h25.34375v69.332031c0 6.53125 3.96875 12.398438 10.027343 14.828125 5.996094 2.453125 12.96875.960938 17.492188-3.734375l138.667969-144c5.972656-6.207031 5.972656-15.976562 0-22.207031zm0 0"
                                />
                                <path d="m448.003906 512.003906h-384c-35.285156 0-63.99999975-28.710937-63.99999975-64v-298.664062c0-35.285156 28.71484375-64 63.99999975-64h64c11.796875 0 21.332032 9.535156 21.332032 21.332031s-9.535157 21.332031-21.332032 21.332031h-64c-11.777344 0-21.335937 9.558594-21.335937 21.335938v298.664062c0 11.777344 9.558593 21.335938 21.335937 21.335938h384c11.773438 0 21.332032-9.558594 21.332032-21.335938v-170.664062c0-11.796875 9.535156-21.335938 21.332031-21.335938 11.800781 0 21.335937 9.539063 21.335937 21.335938v170.664062c0 35.289063-28.714844 64-64 64zm0 0"
                                /></svg>
                        </div>
                        <div class="wrapper-subline-source-type">
                            <span class="subline">
                                <div class="label">ประเภท: </div>
                                <ng-container *ngIf="searchKeywordAll[searchKeywordAll.length - 1].personaType; else elseTemplate">
                                    <div class="value entity-type" (click)="clickEntityType(searchKeywordAll[searchKeywordAll.length - 1].personaType.name)">
                                        {{searchKeywordAll[searchKeywordAll.length - 1].personaType.name }}
                                    </div>
                                </ng-container>
                                <ng-template #elseTemplate>
                                    <div class="value entity-type" (click)="clickNewTabTrend()">
                                        คีย์เวิร์ด
                                    </div>
                                </ng-template>
                            </span>
                            <span class="subline" *ngIf="data.keepDate">
                                <div class="label">เริ่มเก็บข้อมูลตั้งแต่:</div>
                                <div class="value">
                                    {{data.keepDate | date:'dd/MM/yy'}}
                                </div>
                            </span>
                            <span class="subline" *ngIf="data.lastDate">
                                <div class="label">ถูกกล่าวถึงล่าสุด:</div>
                                <div class="value">
                                    {{data.lastDate}}
                                </div>
                            </span>
                        </div>
                    </ng-container>
                    <ng-template #elseIsSearchKeywordAll>
                        <div class="wrapper-source-type-info" *ngIf="sourceType">
                            <span (click)="loadDataPage()">
                                <img class="icon-source-type" src="{{sourceType.icon}}" alt=""> {{ sourceType.name}}
                            </span>
                        </div>
                        <div class="wrapper-subline-source-type">
                            <span class="subline" *ngIf="data.keepDate">
                                <div class="label">เริ่มเก็บข่าวตั้งแต่:</div>
                                <div class="value">
                                    {{data.keepDate | date:'dd/MM/yy'}}
                                </div>
                            </span>
                            <span class="subline" *ngIf="data.lastDate">
                                <div class="label">ลงข่าวล่าสุด:</div>
                                <div class="value">
                                    {{data.lastDate}}
                                </div>
                            </span> 
                        </div>
                    </ng-template>
                    <div class="wrapper-counter-total">
                        <div class="label-total">รวม:</div>
                        <div class="counter-total">
                            <span class="label-counter-total" *ngIf="data.totalNews">
                                {{data.totalNews | shortNumber}}
                            </span>
                            <div class="label-counter">ครั้ง</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="wrapper-right">
                <trend-chart-all [trendingKeyword]="data.trendingSourceTypeAll" [title]="'จำนวนครั้งที่ลงข่าว'"></trend-chart-all>
            </div>
        </div>
        <div class="wrapper-main">
            <div class="wrapper-left">
                <div class="wrapper-newsagency">
                    <div class="wrapper-newsagency-left">
                        <div class="header">
                            <mat-form-field class="selecte-newsagency">
                                <mat-select [(value)]="selectNewsAgencyChart" (selectionChange)="selectedNewsAgencyChart()">
                                    <mat-option *ngFor="let option of listNewsAgencyChartType" [value]="option">
                                        {{option}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="wrapper-list" *ngIf="listChartAgenJouran.newsAgencys && listChartAgenJouran.newsAgencys.length > 0" [class.full-list]="!listChartAgenJouran.jouranlist || listChartAgenJouran.jouranlist.length === 0">
                            <div class="item" *ngFor="let newsAgency of listChartAgenJouran.newsAgencys; let i=index">
                                <div class="chart" id="newsagency_chart{{i+1}}"></div>
                                <div class="newsagency-detail" (click)="newTabNewsAgency(newsAgency.name)">
                                    <div class="newsagency">
                                        <img class="icon" src="{{newsAgency.icon}}" alt="">
                                        <div class="label-newsagency">
                                            {{newsAgency.name}}
                                        </div>
                                    </div>
                                    <div class="wrapper-count">
                                        {{newsAgency.count | shortNumber}}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wrapper-list" *ngIf="listChartAgenJouran.jouranlist && listChartAgenJouran.jouranlist.length > 0" [class.full-list]="!listChartAgenJouran.newsAgencys || listChartAgenJouran.newsAgencys.length === 0">
                            <div class="item" *ngFor="let jouranlist of listChartAgenJouran.jouranlist">
                                <div class="wrapper-journalist">
                                    <div class="journalist-detail">
                                        <img class="avatar" src="{{jouranlist.image}}" alt="">
                                        <div class="label-journalist">
                                            {{jouranlist.name}}
                                        </div>
                                    </div>
                                    <div class="journalist-counter">
                                        <div class="counter">{{jouranlist.count | shortNumber}}</div>
                                        ครั้ง
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="wrapper-newsagency-right">
                        <div class="header">
                            <mat-form-field class="selecte-newsagency" *ngIf="data && data.listNewsAgency">
                                <mat-select [(value)]="selectNewsAgencyCompare" (selectionChange)="selectedNewsAgencyCompare()">
                                    <mat-option disabled [value]="'เปรียบเทียบกับ'">
                                        เปรียบเทียบกับ
                                    </mat-option>
                                    <mat-option *ngFor="let option of data.listNewsAgency" [value]="option._id">
                                        {{option.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <ng-container *ngIf="dataNewsAgencyCompare; else elseNewsAgencyCompare">
                            <div class="item full-width">
                                <div class="chart" id="newsagency_chart_compare"></div>
                                <div class="newsagency-detail" (click)="newTabNewsAgency(dataNewsAgencyCompare.name)">
                                    <div class="newsagency">
                                        <img class="icon" src="{{dataNewsAgencyCompare.icon}}" alt="">
                                        <div class="label-newsagency">
                                            {{dataNewsAgencyCompare.name}}
                                        </div>
                                    </div>
                                    <div class="wrapper-count">
                                        {{dataNewsAgencyCompare.count | shortNumber}}
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                        <ng-template #elseNewsAgencyCompare>
                            <span class="not-select-newsagency-compare">เลือกสื่อที่ต้องเปรียบเทียบ</span>
                        </ng-template>
                    </div>
                </div>
            </div>
            <div class="wrapper-right">
                <entity-top-related [entityTopRelated]="data.entityTopRelated" [isLoadingEntity]="isLoadingEntity" (clickAddEntityInUrl)="addEntityInUrl($event)"></entity-top-related>
            </div>
        </div>
        <div class="wrapper-main">
            <div class="wrapper-left">
                <keyword-top-related [allRelated]="searchKeywordAllWithSourceType" [keywordTopRelated]="data.keywordTop" [isLoadingKeywordTop]="isLoadingKeywordTop"
                    (clickAddKeywordInUrl)="addKeywordInUrl($event)"></keyword-top-related>
            </div>
            <div class="wrapper-right">
                <div class="wrapper-world-map">
                    <div class="title-world-map">
                        การกล่าวถึงในประเทศต่างๆ
                    </div>
                    <div class="geo-chart" id="regions_div"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="wrapper-filter-news">
        <div class="wrapper-counter">
            <div class="header">
                ข่าวทั้งหมด
            </div>
            <div class="sub-header">
                <ng-container *ngIf="data.totalNews; else elseTotalNews">
                    {{ data.totalNews | shortNumber}}
                </ng-container>
                <ng-template #elseTotalNews>
                    0
                </ng-template>
                ครั้ง จาก {{data.countFromSource}} แหล่งที่มา
            </div>
        </div>
        <div class="wrapper-news-agency-select">
            <div class="header-title">
                ค้นหาร่วมกับ
                <div class="list-keyword">
                    <ng-container *ngFor="let keyEntity of searchKeywordAllWithSourceType; let i = index">
                        <span>
                            {{keyEntity.isTag ? "# " : ""}} {{ keyEntity.name}}{{searchKeywordAllWithSourceType.length-1 !== i ? ', ' : ' '}}
                        </span>
                    </ng-container>
                </div>
                :
            </div>
            <div class="wrapper-list">
                <ng-container *ngFor="let source of data.listNewsAgencysWithNews; let index = index">
                    <div class="source-type" [class.active]="source.isActive" (click)="selectNewsAgency(index)">
                        <img class="image" src="{{source.image}}" alt=""> {{source.name}}
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
    <card-news-related [newsRelated]="data.news" [isloadNews]="isloadNews" (searchRelateNews)="searchRelateNews()"></card-news-related>
    <card-keyword-related [keywordRelated]="data.keywordRelates" (clickAddKeywordInUrl)="addKeywordInUrl($event)"></card-keyword-related>
</ng-template>

<div class="footer">
    ความช่วยเหลือ ส่งความคิดเห็น ความเป็นส่วนตัว ข้อกำหนด
</div>